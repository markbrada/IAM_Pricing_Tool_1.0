<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>In A Minnit Pricing Tool 1.0</title>
<style>
/* ---------- THEME VARS ---------- */
:root{
  --bg:#f7f7f7;--fg:#333;
  --header:#e0e0e0;
  --btn:#007bff;--btn-hover:#0056b3;--btn-fg:#fff;
  --border:#aaa;--alt:#f9f9f9;--panel:#fff;
}
.dark-mode{
  --bg:#222;--fg:#eee;
  --header:#444;
  /* lighter blue so contrast is good on dark bg */
  --btn:#3f8cff;--btn-hover:#2d75e6;--btn-fg:#fff;
  --border:#555;--alt:#2a2a2a;--panel:#333;
}

/* ---------- GLOBAL ---------- */
body{font-family:sans-serif;margin:1rem;background:var(--bg);color:var(--fg);transition:.3s}
h1{margin:.2rem 0}p{margin:0 0 2rem}

/* ---------- DARKâ€‘MODE BUTTON ---------- */
#darkModeToggle{position:fixed;top:10px;right:10px;z-index:3000;
  background:var(--btn);color:var(--btn-fg);border:none;padding:.5rem .75rem;
  border-radius:4px;cursor:pointer;transition:.3s}
#darkModeToggle:hover{background:var(--btn-hover)}

/* ---------- TABS ---------- */
#sheetTabs{border-bottom:1px solid var(--border);margin-bottom:1rem}
#sheetTabs button{background:none;border:none;padding:.5rem 1rem;margin-right:.5rem;
  font-size:1rem;color:var(--fg);cursor:pointer}
#sheetTabs button.active{border-bottom:2px solid var(--btn);font-weight:bold}

/* ---------- SEARCH BOX ---------- */
.search-container{margin-bottom:1rem;padding:.5rem;background:var(--panel);
  border:1px solid var(--border);border-radius:4px}
.search-label{font-weight:bold;margin-right:.5rem}
.search-input{padding:.4rem;border:1px solid var(--border);border-radius:4px;
  width:200px;background:var(--panel);color:var(--fg)}
.highlight{background:yellow}

/* ---------- SHEET AREA ---------- */
#sheetContainer{padding-bottom:20vh}

/* ---------- TABLES ---------- */
table{border-collapse:collapse;width:100%}
thead th{position:sticky;top:0;background:var(--header);border:1px solid var(--border);
  padding:.5rem;text-align:center;z-index:2}
tbody td{border:1px solid var(--border);padding:.5rem}
tbody tr:nth-child(even){background:var(--alt)!important}
tbody tr:hover{background:#ccc}

/* ---------- SECTION HEADERS ---------- */
details{margin-bottom:1rem}
summary{list-style:none;cursor:pointer;display:flex;align-items:center;gap:.5rem;
  padding:.4rem .6rem;border-radius:4px;background:var(--header);font-weight:bold;color:#000}
summary::-webkit-details-marker{display:none}
.cat-orange summary{background:#ffe9d6}
.cat-blue   summary{background:#d8ebff}
.cat-brown  summary{background:#f2e6d9}
.cat-red    summary{background:#ffdede}
.cat-yellow summary{background:#fff8d6}
.cat-green  summary{background:#e6f9e5}

/* ---------- COPY FLASH ---------- */
.copied-cell{background:#c8e6c9!important;transition:.15s}
</style>
</head>
<body>
<h1>In A Minnit Pricing Tool 1.0</h1>
<p><em>Beta â€“ features subject to change. Check your work. Report bugs toÂ Marco.</em></p>
<button id="darkModeToggle" aria-label="Toggle dark mode" aria-pressed="false">ToggleÂ DarkÂ Mode</button>

<div id="sheetTabs"></div>
<div id="sheetContainer"></div>

<!-- use SheetJSÂ mini (~180Â kB gzipped) -->
<script src="xlsx.mini.min.js"></script>
<script>
(()=>{"use strict";

/* ---------- CATEGORY META ---------- */
const PRICE_META=[
 ["bannister rail","cat-orange","ðŸ› ï¸"],
 ["stainless steel grabrail","cat-orange","ðŸ› ï¸"],
 ["aluminium grabrail, powder coated","cat-orange","ðŸ› ï¸"],
 ["shower parts","cat-blue","ðŸš¿"],
 ["plumbing","cat-blue","ðŸ”§"],
 ["door components","cat-brown","ðŸšª"],
 ["fire safety","cat-red","ðŸ§¯"],
 ["anti slip solutions","cat-yellow","ðŸ¥¾"],
 ["uncategorised","cat-yellow","ðŸ“¦"]
];
const RATES_META=[
 ["standard rates - property maintenance","cat-green","ðŸ› ï¸"],
 ["standard rates - cleaning","cat-green","ðŸ§¹"],
 ["standard rates - plumbing","cat-green","ðŸ”§"],
 ["standard rates - electrical","cat-green","âš¡ï¸"],
 ["standard rates - weekend work","cat-green","ðŸ“†"],
 ["skip bin and trailer rates","cat-green","ðŸš›"]
];

/* helper: prefix match */
const metaLookup=(str,table,unc)=>{
  const norm=str.trim().toLowerCase();
  for(const [key,cls,emo] of table){
    if(norm.startsWith(key))return {idx:table.indexOf([key,cls,emo]),cls,emo};
  }
  return unc;
};
const PRICE_UNC=metaLookup("uncategorised",PRICE_META);

let wb=null;
const tabs=document.getElementById("sheetTabs"),
      container=document.getElementById("sheetContainer"),
      darkToggle=document.getElementById("darkModeToggle");

darkToggle.onclick=()=>{
  const on=document.body.classList.toggle("dark-mode");
  darkToggle.setAttribute("aria-pressed",on);
};

/* ---------- LOAD SHEETS ---------- */
fetch("myFile.xlsx").then(r=>r.arrayBuffer()).then(buf=>{
  wb=XLSX.read(buf,{type:"array"});
  Object.keys(wb.Sheets).forEach((n,i)=>{
    const btn=document.createElement("button");
    btn.textContent=n;btn.dataset.sheet=n;
    btn.onclick=()=>{selectTab(n);renderSheet(n);}
    if(i===0){btn.classList.add("active");renderSheet(n);}
    tabs.appendChild(btn);
  });
});
const selectTab=n=>[...tabs.children].forEach(b=>b.classList.toggle("active",b.dataset.sheet===n));

/* ---------- RENDER SHEET ---------- */
function renderSheet(name){
  const sheet=wb.Sheets[name];
  const rows=XLSX.utils.sheet_to_json(sheet,{header:1,defval:""});
  const header=rows[0].map(h=>String(h).trim()), catIdx=header.indexOf("Category");
  if(catIdx===-1){container.textContent='No "Category" column.';return;}
  const data=rows.slice(1);

  container.innerHTML=
   '<div class="search-container"><label class="search-label">Search items:</label>\
    <input class="search-input" aria-label="Filter items" placeholder="Type to filter..."></div>';
  const searchInput=container.querySelector(".search-input");
  const wrap=document.createElement("div");container.appendChild(wrap);

  const metaTable=/standard/i.test(name)?RATES_META:PRICE_META;
  const unc=/standard/i.test(name)?RATES_META[RATES_META.length-1]:PRICE_UNC;

  const build=(arr,filtering)=>{
    wrap.innerHTML="";
    const groups={};
    arr.forEach(r=>{
      const c=r[catIdx]||"Uncategorised";(groups[c]=groups[c]||[]).push(r);
    });
    Object.keys(groups)
      .sort((a,b)=>metaLookup(a,metaTable,unc).idx-metaLookup(b,metaTable,unc).idx)
      .forEach(cat=>{
        const m=metaLookup(cat,metaTable,unc);
        const det=document.createElement("details");
        det.open=filtering;               /* autoâ€‘expand when searching */
        det.className=m.cls;
        det.innerHTML=`<summary>${m.emo}&nbsp;&nbsp;${cat}</summary>`;
        const tbl=document.createElement("table");det.appendChild(tbl);
        const thead=document.createElement("thead");
        const hdr=header.slice();hdr.splice(catIdx,1);
        thead.innerHTML='<tr>'+hdr.map(h=>`<th>${h}</th>`).join("")+'</tr>';
        tbl.appendChild(thead);
        const tbody=document.createElement("tbody");tbl.appendChild(tbody);
        groups[cat].forEach(r=>{
          const tr=document.createElement("tr");
          r.forEach((cell,i)=>{
            if(i===catIdx)return;
            const td=document.createElement("td"), h=header[i].toLowerCase();
            td.textContent=/price|gst|rate/.test(h)&&!isNaN(cell)?(+cell).toFixed(2):cell;
            if(/price|gst|rate/.test(h))td.style.fontWeight="bold";
            td.onclick=()=>{
              navigator.clipboard.writeText(td.textContent).then(()=>{
                td.classList.add("copied-cell");void td.offsetWidth;
                setTimeout(()=>td.classList.remove("copied-cell"),150);
              });
            };
            /* highlight if filtering */
            if(filtering){
              const term=searchInput.value.trim();
              if(term){td.innerHTML=td.textContent.replace(
                new RegExp(`(${term})`,"ig"),'<span class="highlight">$1</span>');}
            }
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        wrap.appendChild(det);
      });
  };
  build(data,false);

  searchInput.oninput=()=>{
    const term=searchInput.value.trim().toLowerCase();
    if(!term){build(data,false);return;}
    const filtered=data.filter(r=>r.some(c=>String(c).toLowerCase().includes(term)));
    build(filtered,true);
  };
}
})();
</script>
</body>
</html>
